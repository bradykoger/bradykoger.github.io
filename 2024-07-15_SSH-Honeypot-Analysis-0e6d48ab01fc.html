<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>SSH Honeypot Analysis</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">SSH Honeypot Analysis</h1>
</header>
<section data-field="body" class="e-content">
<section name="dab2" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b5a1" id="b5a1" class="graf graf--h3 graf--leading graf--title">SSH Honeypot Analysis</h3><figure name="5abd" id="5abd" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*8i34YhnDLbCjN2N5ftX0Kg.jpeg" data-width="550" data-height="343" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*8i34YhnDLbCjN2N5ftX0Kg.jpeg"></figure><h3 name="14c3" id="14c3" class="graf graf--h3 graf-after--figure">Purpose</h3><p name="5df5" id="5df5" class="graf graf--p graf-after--h3">While researching cybersecurity ideas to enhance my skills and boost my resume, I came across the term honeypot and how they are integrated into everyday cybersecurity life. Honeypots and their ability to lure in attackers fascinated me and is the reason why I am writing this blog. In this blog, I will give a brief description of honeypots and analyze the honeypots I deployed for this project.</p><h3 name="89b2" id="89b2" class="graf graf--h3 graf-after--p">Introduction</h3><h4 name="2e22" id="2e22" class="graf graf--h4 graf-after--h3">What is a Honeypot?</h4><p name="d94c" id="d94c" class="graf graf--p graf-after--h4">A honeypot can be defined as a system or network that has been deployed to imitate a real network in order to lure malicious actors. These fake systems are isolated from critical infrastructure and monitored by whoever has deployed them.</p><h4 name="6039" id="6039" class="graf graf--h4 graf-after--p">Types of Honeypots</h4><ul class="postList"><li name="f60d" id="f60d" class="graf graf--li graf-after--h4"><strong class="markup--strong markup--li-strong">Production Honeypot:</strong> These types of honeypots are the ones that are going to be used in production environments, whether that is a home lab or your company’s network. They are designed with the main goal of keeping intruders out of critical infrastructure.</li><li name="85da" id="85da" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Research Honeypot:</strong> Used for studying attack methods that adversaries might use when connected to your honeypot. Many use many logging techniques that can track in real time what commands are being used and what kind of malware has been downloaded.</li></ul><h4 name="24d0" id="24d0" class="graf graf--h4 graf-after--li">Roles and Benefits</h4><p name="509f" id="509f" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Early Line of Defense:</strong> Honeypots can act as an early defense mechanism, letting moderators know if an attack is likely to surface.</p><p name="bdb4" id="bdb4" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Response to detection:</strong> The logs that these honeypots produce can tell the owner of the system how bad the attack was and the methods they used to do so. These logs can be crucial to understanding how to mitigate the situation.</p><p name="adbd" id="adbd" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Research:</strong> Attackers nowadays are only getting stronger, and with time, new techniques and scripts are being created. Creating a fake system that is a trap is a good way to reverse engineer new scripts and understand how the new age and old age of hackers work.</p><p name="004f" id="004f" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Misguide:</strong> By luring attackers into this fake production system, consumers can cause the attacker to waste time and resources for no reason.</p><h3 name="07a3" id="07a3" class="graf graf--h3 graf-after--p">Setup and Configuration</h3><h4 name="fa13" id="fa13" class="graf graf--h4 graf-after--h3">Choosing the Right One:</h4><p name="22dc" id="22dc" class="graf graf--p graf-after--h4">When it comes to deploying a honeypot, it is crucial to pick one that meets your specific needs. Attached is a list of common honeypots that you can deploy, and as you can tell, there is much to choose from <a href="https://github.com/paralax/awesome-honeypots" data-href="https://github.com/paralax/awesome-honeypots" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://github.com/paralax/awesome-honeypots</a>. For this specific project, I wanted to be able to track the usernames and passwords and related information associated with brute force attempts, as well as the commands used once logged into an SSH server. Because of this, I chose the <a href="https://github.com/regit/pshitt" data-href="https://github.com/regit/pshitt" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">pshitt</strong> </a>honeypot to track my authentication attempts, and I chose <a href="https://github.com/cowrie/cowrie" data-href="https://github.com/cowrie/cowrie" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">cowrie </strong></a>to track the commands being run once logged in. It is important to find the honeypot that matches your system’s hardware and software requirements while giving you the sought-after results.</p><h4 name="5e51" id="5e51" class="graf graf--h4 graf-after--p">Cloud Service:</h4><p name="4f26" id="4f26" class="graf graf--p graf-after--h4">When deploying a honeypot for research purposes, it is important to air-gap your honeypot so it does not touch your actual system network. If the honeypot is attached to your personal network, you risk compromise and severe repercussions. Because of this, I decided to use a cloud service called Linode to host my two honeypots. Linode offers many different options for hosting your own server, with various cost differences and software and hardware capabilities. I ran both honeypots on the cheapest option, which is the Nanode 1 GB shared CPU. I also deployed a Wazuh server directly from Linode to be able to track alerts created based on the logging output of the honeypots. The Wazuh server is a Linode 2GB shared CPU plan, and I ran the Docker deployment on both Honeypot servers.</p><h3 name="b71f" id="b71f" class="graf graf--h3 graf-after--p">Manual Installation:</h3><p name="f756" id="f756" class="graf graf--p graf-after--h3">I am not going to cover in detail how to manually install each honeypot, as that is not the focus of this blog. However, I can assure you that the installations are very easy and take little time to set up. Linked here are three videos that will aid you in installing PSHITT, Cowrie, and Wazuh.</p><ul class="postList"><li name="2370" id="2370" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Wazuh Installation: </strong><a href="https://www.youtube.com/watch?v=3CaG2GI1kn0&amp;t=383s" data-href="https://www.youtube.com/watch?v=3CaG2GI1kn0&amp;t=383s" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?v=3CaG2GI1kn0&amp;t=383s</a></li><li name="e7b1" id="e7b1" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">PSHITT Installation:</strong> <a href="https://www.youtube.com/watch?v=pK19ifUplMQ" data-href="https://www.youtube.com/watch?v=pK19ifUplMQ" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?v=pK19ifUplMQ</a></li><li name="99d7" id="99d7" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">COWRIE Installation:</strong> <a href="https://www.youtube.com/watch?v=yAGOWn4KCPU&amp;t=589s" data-href="https://www.youtube.com/watch?v=yAGOWn4KCPU&amp;t=589s" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?v=yAGOWn4KCPU&amp;t=589s</a></li></ul><h3 name="6c58" id="6c58" class="graf graf--h3 graf-after--li">Wazuh</h3><p name="06e5" id="06e5" class="graf graf--p graf-after--h3">I want to briefly discuss the integration of Wazuh into this project. Wazuh is a free and open-source security information and event management (SIEM) tool that monitors the security of IT assets. I wanted to gain knowledge of installing and using a SIEM to create rules that would alert me when specific things happened. In Wazuh, I created rules that would allow me to alert when users log into my honeypot and gave me results such as usernames and passwords used or the commands that they run.</p><figure name="5bf7" id="5bf7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*RZtw8AnqM5VwvMKpJC0xGw.png" data-width="873" data-height="830" src="https://cdn-images-1.medium.com/max/800/1*RZtw8AnqM5VwvMKpJC0xGw.png"></figure><figure name="c9d1" id="c9d1" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*opVMLUCJ6SVLJWuqHU1ITg.png" data-width="996" data-height="615" src="https://cdn-images-1.medium.com/max/800/1*opVMLUCJ6SVLJWuqHU1ITg.png"></figure><p name="6bc8" id="6bc8" class="graf graf--p graf-after--figure">Pictured above are alerts created by the Wazuh server that notify me in real time. What’s great about Wazuh is that it stores the characteristics provided in the alerts and allows you to create visual dashboards to easily visualize your data. The pie chart above is an example of the top 10 passwords that were logged for a certain period of time.</p><h3 name="2d15" id="2d15" class="graf graf--h3 graf-after--p">PSHITT Analysis</h3><p name="de2c" id="de2c" class="graf graf--p graf-after--h3">We will now delve deeper into my PSHITT honeypot analysis. As a reminder, this is the honeypot where we focused on credential harvesting. All login attempts to the honeypot were sent to a file called password_trap.json. Here is an example of a login attempt entry captured by the honeypot: {“username”: “ftp”, “password”: “12345”, “src_ip”: “79.110.62.145”, “src_port”: 40635, “timestamp”: “2024–06–27T00:48:42.470608”, “software_version”: “libssh2_1.9.0”, “cipher”: “aes128-ctr”, “mac”: “hmac-sha2–256”, “try”: 4}. In total, I was able to capture 82,888 records over a short span of two weeks.</p><h4 name="aa2a" id="aa2a" class="graf graf--h4 graf-after--p">Credentials</h4><p name="1f21" id="1f21" class="graf graf--p graf-after--h4">When analyzing the top 10 usernames that were used to login to the honeypot, I was unable to find anything super out of the ordinary. Root, of course, was the number one username tried with 58431 attempts, while the second most “admin” was only attempted 2047 times. While it is not unusual for a top username, I was a little surprised when I saw that deploy and dev cracked the top 10. I was expecting common usernames such as guest, administrator, pi, etc. to have a higher occurrence rate. One interesting username that I found, which was also used as a password, was a log4j jdni vulnerability. When you have logging capabilities like the honeypot I am using, all output of activities will be shown in the logs. Log4j will request data from an LDAP (Lightweight Directory Access Protocol); however, if the URL associated with this leads to a malicious payload, it can harm the Java application. You can read further on this vulnerability <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" data-href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>. Out of the 82,888 login attempts, 1,862 unique usernames were attempted, while only 254 of them were tried more than 10 times.</p><figure name="443a" id="443a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*VCHleqaze3RFTJT2MHAX0w.png" data-width="550" data-height="509" src="https://cdn-images-1.medium.com/max/800/1*VCHleqaze3RFTJT2MHAX0w.png"></figure><p name="227d" id="227d" class="graf graf--p graf-after--figure">Next, we will look at the top passwords that were logged. The most common password, “123456,” was pretty expected. I was kind of surprised that “root” wasn’t in contention for the number one spot, but even more surprised to see it fall to number 5. The biggest surprise on the list is the password, which we found in the number 2 spot, which was “amethyst.” . While there is not too much information on this term online, I did find a macOS tiling window manager called Amethyst. While this is most likely the cause of the word amethyst being used, I find it hard to believe that it was so high on the list as my machine is an Ubuntu and not a macOS machine. While numbered passwords will always be on this list, I expect longer-numbered passwords to be higher on the list in the future due to password strength requirements being more widespread. There were 27,327 unique passwords in our data set, while 1,106 passwords occurred over 10 times.</p><figure name="34e0" id="34e0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*wEDMLGAEKqQTA2UH9D3uRw.png" data-width="550" data-height="508" src="https://cdn-images-1.medium.com/max/800/1*wEDMLGAEKqQTA2UH9D3uRw.png"></figure><p name="4b40" id="4b40" class="graf graf--p graf-after--figure">The top username and password combinations were all to be expected, besides, of course, our amethyst password. Root/amethyst had a total of 836 login attempts, which was a lot more than our second highest occurrence of root/root, which had only 150 attempts. The number 836 shows us that out of the 918 password attempts for amethyst that only 82 of those attempts used a different username than root.</p><figure name="9db9" id="9db9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*lZNrpeu0hSsCVY1sfzxE8Q.png" data-width="550" data-height="508" src="https://cdn-images-1.medium.com/max/800/1*lZNrpeu0hSsCVY1sfzxE8Q.png"></figure><h4 name="316c" id="316c" class="graf graf--h4 graf-after--figure">Timing Of Attacks</h4><p name="a688" id="a688" class="graf graf--p graf-after--h4">I was curious to see if certain days of the week or hours of the day would be trends for a large or small amount of brute force attacks. I was expecting hours of limited computer use to be a popular time, as well as on days when users may not be accessing their systems. For example, Sunday at 2:00 a.m. seems like a good time to attack. I found that each day for the 2 weeks I performed this experiment seemed to have a normal distribution except for a particular outlier on July 4. On July 4, over 20,000 login attempts occurred, which was vastly different from the average of around 4,800. After digging into the json and log files, I discovered that a certain IP attacked over 12,000 times within a span of 3 hours, skewing the data. This outlier can also be seen in my attempts by day of the week chart, where Thursday is by far the most busy, and in my hour of the day chart, where 2–5:00pm is by far the most busy. Without this outlier, it seems to be a pretty normal distribution, and I didn’t find anything that would indicate that the attacks were anything but random.</p><figure name="0d89" id="0d89" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*2ZSXeBPtPZyk4j1BEqj9Fw.png" data-width="550" data-height="413" src="https://cdn-images-1.medium.com/max/800/1*2ZSXeBPtPZyk4j1BEqj9Fw.png"></figure><figure name="5030" id="5030" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*J2w7MI5WOAUGroXNc4bbKA.png" data-width="550" data-height="450" src="https://cdn-images-1.medium.com/max/800/1*J2w7MI5WOAUGroXNc4bbKA.png"></figure><figure name="6e9f" id="6e9f" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*-2MvGVfET5dEjs3wl8CTFw.png" data-width="550" data-height="413" src="https://cdn-images-1.medium.com/max/800/1*-2MvGVfET5dEjs3wl8CTFw.png"></figure><h4 name="5131" id="5131" class="graf graf--h4 graf-after--figure">Origin of Attack</h4><p name="b389" id="b389" class="graf graf--p graf-after--h4">When talking about the origin of these IP addresses that were logged, you have to take the results with a grain of salt. This is because with the use of VPNs, proxies, and the Tor network, it has become very easy to spoof an IP address. Nonetheless, I thought it would be cool to look for trends in the location of the IP’s. I used a command-line Linux tool called geoiplookup to perform this. Results showed a majority of the locations coming from the United States, where 612 out of the 2509 unique IP addresses came from. To my surprise, Russia was only rated 6th with 88 attempts, and to an even bigger surprise, China did not come close to cracking the top 10. The Linode server I am hosting is set to the Atlanta region, so I figured a lot of activity would come from those nations.</p><figure name="5a26" id="5a26" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*_2ud9xePfC8Brp3rcYrtUA.png" data-width="500" data-height="524" src="https://cdn-images-1.medium.com/max/800/1*_2ud9xePfC8Brp3rcYrtUA.png"></figure><h4 name="804e" id="804e" class="graf graf--h4 graf-after--figure">Requests</h4><p name="dd56" id="dd56" class="graf graf--p graf-after--h4">After analyzing the data and the number of times each IP sent attacks, I noticed that a majority of them sent 1 request, which was expected, but I also found that most of the IP’s sent exactly 30 requests. In my mind, I am thinking that this is probably an attempt to conserve resources. They configure the bots to quit after 30 login attempts because the likelihood of logging in after 30 failed attempts is not good enough to spend the resources or time. Another likely reason for this could be password lockout mechanisms. I couldn’t figure out if certain services lock out, especially after over 30 login attempts, so while this theory is not as sustained, it could be a reason.</p><figure name="99a7" id="99a7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*WzV8skbwCmZMb75xxYAAwA.png" data-width="650" data-height="488" src="https://cdn-images-1.medium.com/max/800/1*WzV8skbwCmZMb75xxYAAwA.png"></figure><h4 name="dea4" id="dea4" class="graf graf--h4 graf-after--figure">Client Software</h4><p name="7261" id="7261" class="graf graf--p graf-after--h4">The client software these attackers were using wasn’t too out of the ordinary. Like the IP’s location, this can be easily spoofed, so we have to take it with a grain of salt. I was, however, a little surprised to not see PuTTY up there. One interesting thing was that if we assume these client software’s are not spoofed, then the data shows that a lot of the versions of the client software are very old. I originally found this to be odd, but then realized that the computers making these requests are most likely bots from compromised computers. It would make sense for these compromised computers to have outdated software, hence why they were compromised in the first place.</p><figure name="a551" id="a551" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*oWqY4HHBdm74bSaVPq7PRA.png" data-width="550" data-height="508" src="https://cdn-images-1.medium.com/max/800/1*oWqY4HHBdm74bSaVPq7PRA.png"></figure><h4 name="7845" id="7845" class="graf graf--h4 graf-after--figure">PSHITT Overview</h4><p name="79f5" id="79f5" class="graf graf--p graf-after--h4">While the PSHITT honeypot isn’t going to give you groundbreaking logging of hackers, it is a nice lightweight tool to track trends in brute force attacks. In order to further study the trends and make more accurate assumptions, I would like to continue running this honeypot for a period of around 3 months. As you can tell from the data in the timing section, 2 weeks is not nearly enough time to see accurate trends due to the lack of size in the data set. Most everything seemed pretty predictable, with a few exceptions, such as the amethyst password. I am looking forward to researching more about the specific client software’s differences, as I do not have much experience with the differences between them.</p><h3 name="b825" id="b825" class="graf graf--h3 graf-after--p">Cowrie</h3><p name="9666" id="9666" class="graf graf--p graf-after--h3">Next, we will discuss the results found by our cowrie honeypot. As a reminder, this honeypot was a medium-interaction ssh honeypot that I deployed in order to track commands and scripts that attackers were using. This honeypot allowed access to the system with any username/password combination. For our analysis, we will look at some of the most used and unique commands we found in our log files.</p><h4 name="0c8a" id="0c8a" class="graf graf--h4 graf-after--p">Commands</h4><figure name="c8f0" id="c8f0" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*S3h8H9639Di6W-QEzPDyTg.png" data-width="313" data-height="36" src="https://cdn-images-1.medium.com/max/800/1*S3h8H9639Di6W-QEzPDyTg.png"></figure><p name="d3ce" id="d3ce" class="graf graf--p graf-after--figure">This command unlocks the .ssh file allowing a use to execute read and write permissions.</p><figure name="fc95" id="fc95" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*iycwLqmbY-5tsWxfJUziag.png" data-width="358" data-height="31" src="https://cdn-images-1.medium.com/max/800/1*iycwLqmbY-5tsWxfJUziag.png"></figure><p name="221e" id="221e" class="graf graf--p graf-after--figure">This command deletes the systems .ssh directory and recreated it and used its own ssh public key to allow access to the system. The username attributed to this command was “mdrfckr,” which can be traced to the <a href="https://yoroi.company/en/research/outlaw-is-back-a-new-crypto-botnet-targets-european-organizations/" data-href="https://yoroi.company/en/research/outlaw-is-back-a-new-crypto-botnet-targets-european-organizations/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Outlaw Hacking Group and the Monero Shellbot</a>. By gaining access to the system via the ssh directory the attacker has essentially free reign to do hacker thing such as downloading malware.</p><figure name="e4ad" id="e4ad" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Hxo5AZIdHWTEkoHykdrIyw.png" data-width="427" data-height="65" src="https://cdn-images-1.medium.com/max/800/1*Hxo5AZIdHWTEkoHykdrIyw.png"></figure><p name="de9e" id="de9e" class="graf graf--p graf-after--figure">By running this command an adversary attempts to create a new user with administrator or sudo privileges&#39; giving them access to do anything on the system.</p><figure name="7b5b" id="7b5b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*BBFnXEHiYLlHur-MkDHTpw.png" data-width="68" data-height="29" src="https://cdn-images-1.medium.com/max/800/1*BBFnXEHiYLlHur-MkDHTpw.png"></figure><p name="1242" id="1242" class="graf graf--p graf-after--figure">While looking through commands, I noticed the term busybox involved in a multitude of commands. After doing research, I found that busybox is a tool used to combine common Linux commands such as ls, enable, and wget into a single executable file. It is lightweight and allows attacks to have a very minimal footprint. While we will not dive into every specific use of busybox in this honeypot, just know that it is used for all types of attacks we recorded.</p><figure name="bb28" id="bb28" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZAG92tOO3mLZnp-95C2ZbA.png" data-width="157" data-height="35" src="https://cdn-images-1.medium.com/max/800/1*ZAG92tOO3mLZnp-95C2ZbA.png"></figure><p name="e210" id="e210" class="graf graf--p graf-after--figure">This simple command like the name states returns information of the computers processor. This is a baseline for hackers and allows them to study what kind of system and the capabilities of that system that they are attacking.</p><figure name="fd9b" id="fd9b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8fr56hxjzH_BblEG7ljtvQ.png" data-width="177" data-height="35" src="https://cdn-images-1.medium.com/max/800/1*8fr56hxjzH_BblEG7ljtvQ.png"></figure><p name="072a" id="072a" class="graf graf--p graf-after--figure">A colleague once told me that hackers have two methods to earn what they want most, which is money. These are ransomware or using a computer’s resources without the owner’s knowledge. In this case, the hacker is using the command to find out if any processes are running a crypto miner. If they are, the adversary knows it cannot use this computer, but if they aren’t, they can further add malware that will include a crypto miner, making them money.</p><figure name="c702" id="c702" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xLZLJ5lhMqMoTQvRInwG3Q.png" data-width="762" data-height="97" src="https://cdn-images-1.medium.com/max/800/1*xLZLJ5lhMqMoTQvRInwG3Q.png"></figure><p name="ee20" id="ee20" class="graf graf--p graf-after--figure">This is a perfect example of how an attacker can use curl, wget, and ftpget to download malware on your system. In this specific command, we can see that an attack wants to download Sora, Sora 1, and Sora 2 and searches for a directory where they can do so. Upon further investigation, Sora seems to be a Mirai variant. The attacker then removes all trace of these files and anything occurring on the system to cover their tracks.</p><h4 name="393c" id="393c" class="graf graf--h4 graf-after--p">Downloads</h4><p name="2011" id="2011" class="graf graf--p graf-after--h4">A very cool and useful feature of cowrie is that it stores everything downloaded from the hackers into its own separate folder, making it easy to analyze. Below are the types of files that were captured.</p><figure name="be49" id="be49" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*tsMKPsG-R46CyMh6y1cUZQ.png" data-width="1024" data-height="768" src="https://cdn-images-1.medium.com/max/800/1*tsMKPsG-R46CyMh6y1cUZQ.png"></figure><p name="b63f" id="b63f" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">ELF:</strong> This file type stands for Executable and Linkable Format. The executable version is a program that can be run standalone and runs directly on the Linux system. The shared versions are .so libraries that have resources that other programs may access. These files were all encrypted.</p><p name="4e74" id="4e74" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">OpenSSH RSA public key:</strong> These are keys that are used to authenticate to an SSH server. If you take a look back and look at the second command I provided, you can see that these public keys were downloaded in an attempt to replace the one already on the system.</p><p name="2bdf" id="2bdf" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Bourne-Again shell script:</strong> This refers to bash scripts that are written in ASCII text. These scripts can be directly used by the shell. The three particular instances of bash scripts found were crontab cleanup, redtail, and sora script. The crontab cleanup script was used to disable anything malicious or directories made within the attack, essentially covering their tracks. It also stopped a particular crypto miner called c3pool_miner. The Redtail program is malware used by RedTail to cryptomine by exploiting Palo Alto Networks firewall zero-day flaws. The Sora program is used to download Sora, which is a variant of Mirai with the end goal of brute forcing weak systems and creating a botnet.</p><p name="43c5" id="43c5" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">ASCII:</strong> This is just downloaded text that cannot be executed. I found it so interesting that one of these files only contained the word “senpai.” After doing a quick Google search, I found that it is a Japanese term for “mentor.” I wasn’t sure how to take this; originally, I thought it would be a hacker teasing me for figuring out he was in a honeypot. After some initial digging, I found that the author of the Mirai botnet was nonetheless Anna-senpai.</p><h4 name="a46c" id="a46c" class="graf graf--h4 graf-after--p">Cowrie Overview</h4><p name="fd7c" id="fd7c" class="graf graf--p graf-after--h4">Installing and deploying the cowrie honeypot was very satisfying and informative. I was able to introduce myself to a lot of new commands and get first-hand insight on what attackers may be doing every day. I really enjoyed learning about crypto mining attacks, as crypto is an area that I think is very entertaining. While there were thousands of different unique commands, I hope you find the ones I provided interesting, as they were the most used.</p><h3 name="74f7" id="74f7" class="graf graf--h3 graf-after--p">Data Gathering</h3><p name="17c0" id="17c0" class="graf graf--p graf-after--h3">I used various python and bash scripts in order to analyze the data found in the log files.</p><h3 name="c686" id="c686" class="graf graf--h3 graf-after--p">Mitigations</h3><p name="1627" id="1627" class="graf graf--p graf-after--h3">Honeypots are not the only way to stop attackers from accessing your critical infrastructure. Here is a few alternatives to honeypots that achieve similar results.</p><ul class="postList"><li name="a806" id="a806" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Account Lockout Mechanism</strong></li><li name="5116" id="5116" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Rate limiting</strong></li><li name="6319" id="6319" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">IP white list/ black list</strong></li></ul><h3 name="9c1c" id="9c1c" class="graf graf--h3 graf-after--li">Next Steps</h3><p name="eefa" id="eefa" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Further analysis:</strong> Because of the limited time I had to complete this project, I was not able to gather the amount of results I would have liked to. As you could tell from the timing attacks, one outlier caused the results to be very skewed. Over time, with more log records, I will be able to gain a better understanding of brute force attacks and the commands that are associated with them. Next time I do this project, I will aim for 3 months of data gathering.</p><p name="cee8" id="cee8" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">My own honeypot:</strong> Instead of using honeypots like the one in the project that is available on GitHub, I would like to code my own honeypot. I would use Python as my coding language and start with a lightweight SSH honeypot. After this, I would like to add more capabilities and expand upon different services.</p><p name="dd5e" id="dd5e" class="graf graf--p graf-after--p graf--trailing"><strong class="markup--strong markup--p-strong">Wazuh Email Alerts:</strong> In the future I would like to setup Wazuh email alerts. This would allow me to send specific alerts based on their rule number and the severity of the alert. I would configure this to send alerts to everyone managing the network to allow them to be notified if something requires their immediate attention.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@bradyclaykoger" class="p-author h-card">Brady koger</a> on <a href="https://medium.com/p/0e6d48ab01fc"><time class="dt-published" datetime="2024-07-15T14:44:32.227Z">July 15, 2024</time></a>.</p><p><a href="https://medium.com/@bradyclaykoger/ssh-honeypot-analysis-0e6d48ab01fc" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 17, 2024.</p></footer></article></body></html>